# L1.7 — Конкурентная запись в map
<h1 align="center"><img width="668" height="433" alt="image" src="https://github.com/user-attachments/assets/1131f970-98ab-4d51-8ed6-6ca4e93bd22d" /></h1>
## Описание

В Go обычные map не являются потокобезопасными. При одновременной записи в map из нескольких горутин может возникнуть состояние гонки (race condition), что приведет к непредсказуемому поведению или панике программы.

Данная программа демонстрирует решение этой проблемы через создание потокобезопасной обертки над map с использованием мьютекса.

## Структура SafeMap

```go
type SafeMap struct {
    mu   sync.Mutex    // Мьютекс для синхронизации доступа
    data map[int]int   // Внутренняя map для хранения данных
}
```

### Конструктор
```go
func NewSafeMap() *SafeMap {
    return &SafeMap{
        data: make(map[int]int),
    }
}
```

### Методы

#### Set(key, value int)
Безопасно записывает значение по ключу:
- Блокирует мьютекс перед записью
- Выполняет запись в map
- Автоматически разблокирует мьютекс через defer

#### Get(key int) (int, bool)
Безопасно читает значение по ключу:
- Блокирует мьютекс перед чтением
- Возвращает значение и флаг существования ключа
- Автоматически разблокирует мьютекс через defer

## Демонстрация работы

Программа запускает 100 горутин, каждая из которых записывает свое значение в SafeMap:

```go
for i := 0; i < numGoroutines; i++ {
    go func(key int) {
        defer wg.Done()
        sMap.Set(key, key*10)  // Безопасная запись
    }(i)
}
```

## Почему это важно?

Без мьютекса такой код мог бы привести к:
- Состоянию гонки (race condition)
- Паническому завершению программы
- Потере данных
- Непредсказуемому поведению

## Запуск

```bash
go run L1.7.go
```

## Пример вывода

```
Проверка записи:
Ключ: 0, Значение: 0
Ключ: 1, Значение: 10
Ключ: 2, Значение: 20
Ключ: 3, Значение: 30
Ключ: 4, Значение: 40

Всего записей в map: 100
```

## Альтернативные решения

Помимо использования мьютекса, в Go существуют и другие способы обеспечения потокобезопасности:

1. **sync.Map** — встроенная потокобезопасная map
2. **Каналы** — для передачи данных между горутинами
3. **sync/atomic** — для атомарных операций над простыми типами

Выбор зависит от конкретных требований к производительности и сложности логики.